# Learning Behavior Trees from Planning Experts Using Data Mining and Logic Factorization

This README will guide you to generate the results presented in the paper _Learning Behavior Trees from Planning Experts Using Decision Tree and Logic Factorization_. This repository is the so called SETUPI in the paper.
## Install
1. Install python3.8 and R
2. Install [GraphViz](https://graphviz.org/download/) 
3. (Optional) create a  python3 [virtual environment](https://docs.python.org/3/library/venv.html) and activate it
4. Install packages in python
      ```pip install pydot pyyaml matplotlib celluloid sympy wheel pandas sklearn graphviz networkx pyeda```
      If you have troubles installing pyeda in windows, we provide the wheel file. Run the command
      ```pip install pyeda-0.28.0-cp38-cp38-win_amd64.whl```
      If you want to visualize the tree (more instruction later) run 
      ```pip install IPython ```
5. Install packages in R
      ``` install.packages('C50')```
      Check the settings and change them so the output will be saved in the top level directory

## Reproducing the results for Correctness and Performance

Open a terminal in the top level directory. Note that these steps are sequential and they need to be run in order. If you would like to skip one step, in the ```output``` folder we provide the files (created during the steps) that are needed to run the following steps. Copy paste the file in the right directory and run the next step

0. (Optional) If you want to visualize the manually defined initial BT run the notebook ```show_BT.ipynb ```
This notebook can be used to easily visualize any BT given its definition (string).

1. To create the simulation data copy paste in the terminal:
      ```python run_simulations.py```
_Expected output_: ```ExecutedTraces.csv``` in the top level directory

2. To learn the rules run the script ```c50.R``` in R
_Expected output_: ```c50-rules.txt``` in the top level directory

3. 1. To convert the rules into the BT using BT-Factor copy paste in the terminal:
      ```python BT-Factor.py```
_Expected output_: BTFactor folder in the top level directory with 3 ```behavior_tree``` files (```.dot```, ```.png```, ```.svg```) and the ```BT.py``` file. The BT (string form) will be printed in the terminal

   2. To convert the rules into the BT using BT-Factor without Horn Clauses change the ```defaul_action_and_horn_clauses``` variable (defined at line 19 of ```BT-Factor.py```) to ```False```, save and copy paste in the terminal: 
      ```python BT-Factor.py```
   _Expected output_: BTFactor_DNF folder in the top level directory with 3 ```behavior_tree``` files (```.dot```, ```.png```, ```.svg```) and the ```BT.py``` file. The BT (string form) will be printed in the terminal

4. To One-Hot-Encoding the executed traces and thus creating the input for RE:BT-Espresso copy paste in the terminal:
      ```python hotencode.py ```
_Expected output_: ```ExecutedTracesOneHot.csv ```

5. To run RE:BT-Espresso copy paste in the terminal:
      ```python RE-BT-Espresso.py```
  Note that we already provide the pruning values (line 578 of ```RE-BT-Espresso.py```) generated by using the minimal cost-complexity pruning (Wathieu et all. 2022). If you want to run with different pruning values comment line line 578 of ```RE-BT-Espresso.py```

      _Expected output_: REBTEspresso folder in the top level directory with 3 ```behavior_tree``` files (```.dot```, ```.png```, ```.svg```), and 3 ```python``` files (```BT.py```, ```alpha.py```, ```possible_to_improve.py```). The BTs (string form) will be printed in the terminal

6. To run 200 simulations, copy paste in the terminal
      ```python run_experiments.py```
_Expected output:_ ```performance-correctness.csv``` in the \results directory

7. To compute the results copy paste in the terminal:
      ```python evaluation.py ```
_Expected output_: results printed in the terminal

8. To compute the GED results presented in Table 4 copy paste in the terminal:
      ```python GED-Calculation.py ```
_Expected output_: ```GED.txt `` in the \results directory
